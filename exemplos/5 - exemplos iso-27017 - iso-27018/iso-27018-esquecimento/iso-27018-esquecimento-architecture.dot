// ISO 27018 - Direito ao Esquecimento
digraph {
	nodesep=0.8 rankdir=TB ranksep=1.0 splines=ortho
	node [fontname=Arial fontsize=10 shape=box style="rounded,filled"]
	fontname="Arial Bold" fontsize=16 label="ISO 27018 - Direito ao Esquecimento (LGPD Art. 18, VI)
Prazo: < 15 dias | SLA: 5 minutos" labelloc=t
	titular [label="Titular de Dados
üë§
Solicita√ß√£o de Exclus√£o
LGPD Art. 18, VI" fillcolor="#34495E" fontcolor=white shape=person]
	api [label="API Gateway
üåê
POST /data-erasure
{\"user_id\": \"12345\"}" fillcolor="#E67E22" fontcolor=white]
	subgraph cluster_queue {
		color="#FFF4E6" label="Gerenciamento de Solicita√ß√µes" style=filled
		sqs [label="SQS Queue
üì¨
Reten√ß√£o: 14 dias
DLQ habilitada
FIFO: ‚úÖ" fillcolor="#D4145A" fontcolor=white]
		dlq [label="Dead Letter Queue
‚ö†Ô∏è
Falhas ap√≥s 3 tentativas" fillcolor="#C0392B" fontcolor=white]
	}
	subgraph cluster_lambda {
		color="#FFE5CC" label="Processamento de Exclus√£o" style=filled
		lambda_func [label="Lambda Function
‚ö°
Timeout: 5 min
Memory: 1024 MB
Concurrency: 10" fillcolor="#FF9900" fontcolor=white]
		steps [label="Passos de Exclus√£o:
1Ô∏è‚É£ Validar solicita√ß√£o
2Ô∏è‚É£ Excluir de S3
3Ô∏è‚É£ Excluir de DynamoDB
4Ô∏è‚É£ Excluir de RDS
5Ô∏è‚É£ Registrar exclus√£o
6Ô∏è‚É£ Notificar titular" fillcolor="#FFB74D" fontcolor=black shape=note]
	}
	subgraph cluster_datasources {
		color="#E3F2FD" label="Fontes de Dados Pessoais" style=filled
		s3_data [label="S3 Bucket
üì¶
Fotos, documentos" fillcolor="#569A31" fontcolor=white]
		dynamo_data [label="DynamoDB
üóÑÔ∏è
Perfil de usu√°rio" fillcolor="#527FFF" fontcolor=white]
		rds_data [label="RDS Database
üíæ
Transa√ß√µes, hist√≥rico" fillcolor="#3B48CC" fontcolor=white]
		elasticsearch [label="ElasticSearch
üîç
√çndices de busca" fillcolor="#005571" fontcolor=white]
	}
	subgraph cluster_registry {
		color="#E8F5E9" label="Auditoria de Exclus√µes (7 anos)" style=filled
		audit_table [label="DynamoDB Audit Table
üìã
PITR: ‚úÖ
Registro imut√°vel:
- user_id
- timestamp
- sistemas afetados
- quem solicitou" fillcolor="#43A047" fontcolor=white]
		cloudwatch [label="CloudWatch Logs
üìä
Reten√ß√£o: 7 anos
LGPD Art. 37" fillcolor="#66BB6A" fontcolor=white]
	}
	subgraph cluster_notification {
		color="#F3E5F5" label="Confirma√ß√£o ao Titular" style=filled
		ses [label="Amazon SES
üìß
Email de confirma√ß√£o
Comprovante de exclus√£o" fillcolor="#8E44AD" fontcolor=white]
		sns_notify [label="SNS Topic
üì≤
Notifica DPO
Compliance Team" fillcolor="#9B59B6" fontcolor=white]
	}
	titular -> api [label="1. POST request" color=blue fontcolor=blue]
	api -> sqs [label="2. Enqueue" color=blue fontcolor=blue]
	sqs -> lambda_func [label="3. Trigger" color=orange fontcolor=orange]
	lambda_func -> steps [style=invis]
	lambda_func -> s3_data [label="4a. DELETE objects" color=red fontcolor=red]
	lambda_func -> dynamo_data [label="4b. DELETE items" color=red fontcolor=red]
	lambda_func -> rds_data [label="4c. DELETE rows" color=red fontcolor=red]
	lambda_func -> elasticsearch [label="4d. DELETE indices" color=red fontcolor=red]
	lambda_func -> audit_table [label="5. Register erasure" color=green fontcolor=green]
	lambda_func -> cloudwatch [label="6. Log execution" color=green fontcolor=green style=dashed]
	lambda_func -> ses [label="7a. Email titular" color=purple fontcolor=purple]
	lambda_func -> sns_notify [label="7b. Notify team" color=purple fontcolor=purple]
	sqs -> dlq [label="Ap√≥s 3 falhas" color=red fontcolor=red style=dashed]
	alarm [label="CloudWatch Alarm
üö®
Monitora:
- DLQ depth > 0
- Lat√™ncia > 5 min
- Taxa de erro > 1%" fillcolor="#E74C3C" fontcolor=white shape=diamond]
	dlq -> alarm [label="triggers alert" color=red style=dashed]
	cloudwatch -> alarm [label=monitors style=dotted]
	ses -> titular [label="8. Confirma√ß√£o
\"Seus dados foram exclu√≠dos\"" color=green fontcolor=green style=bold]
	subgraph cluster_timeline {
		color="#FFFDE7" label="Timeline de Processamento" style=filled
		timeline [label="T0: Solicita√ß√£o recebida
‚è±Ô∏è T+2min: Exclus√£o de S3/DynamoDB
‚è±Ô∏è T+3min: Exclus√£o de RDS
‚è±Ô∏è T+4min: Registro de auditoria
‚è±Ô∏è T+5min: Confirma√ß√£o enviada
‚úÖ SLA: < 15 dias (LGPD)" fillcolor="#FFF9C4" shape=note]
	}
	subgraph cluster_legend {
		color=white label="Requisitos LGPD" style=filled
		leg1 [label="‚úÖ Art. 18, VI: Direito ao esquecimento
‚úÖ Art. 37: Auditoria por 7 anos
‚úÖ Prazo: M√°ximo 15 dias" fillcolor=lightgreen shape=note]
		leg2 [label="üîí Garantias:
- Processamento idempotente
- Registro imut√°vel (PITR)
- Comprovante de exclus√£o
- Rastreabilidade completa" fillcolor=lightblue shape=note]
		leg3 [label="‚ö†Ô∏è Multas evitadas:
- N√£o atendimento: R$ 50 milh√µes
- Sem comprova√ß√£o: San√ß√µes ANPD
- Prazo excedido: Advert√™ncias" fillcolor="#FFCCBC" shape=note]
	}
	dpi=300
}
